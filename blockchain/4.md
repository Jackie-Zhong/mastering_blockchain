### 比特币的基本原理

与传统银行和支付系统不同，比特币系统是以去中心化信任为基础的。由于比特币网络中不存在中央权威信任机构，“信任”成为了比特币用户之间存在的一种突出特性。我们将从一个较高层面检视比特币，通过追踪一笔比特币系统中的单独交易，来看看它在比特币分布式共识机制中变得“被信任”和“被接受”的情形，以及最终成功地被存储到区块链中。

#### 概述

![](https://github.com/zeoio/mastering_blockchain/blob/master/blockchain/pictures/2-1.png)

我们可以看到比特币系统由用户（用户通过密钥控制钱包）、交易（每一笔交易都会被广播到整个比特币网络）和矿工（通过竞争计算生成在每个节点达成共识的区块链，区块链是一个分布式的公共权威账簿，包含了比特币网络发生的所有的交易）组成。在本节中，我们将通过追踪在网络上传输的一笔交易，从整个比特币系统的的视角检视各个部分之间的交互。

#### 交易

简单来说，交易告知全网：比特币的持有者已授权把比特币转帐给其他人。而新持有者能够再次授权，转移给该比特币所有权链中的其他人，产生另一笔交易来花掉这些比特币，后面的持有者在花费比特币也是用类似的方式。

交易就像复式记账法账簿中的行。简单来说，每一笔交易包含一个或多个“输入”，输入是针对一个比特币账号的负债。这笔交易的另一面，有一个或多个“输出”，被当成信用点数记入到比特币账户中。这些输入和输出的总额（负债和信用）不需要相等。相反，当输出累加略少于输入量时，两者的差额就代表了一笔隐含的“矿工费”，这也是将交易放进账簿的矿工所收集到的一笔小额支付。

![](https://github.com/zeoio/mastering_blockchain/blob/master/blockchain/pictures/2-3.png)

交易也包含了每一笔被转移的比特币（输入）的所有权证明，它以所有者的数字签名形式存在，并可以被任何人独立验证。

![](https://github.com/zeoio/mastering_blockchain/blob/master/blockchain/pictures/2-4.png)

#### 挖矿

当交易在比特币网络上传播开时，只有被一个称为挖矿的过程验证且加到一个区块中之后，这个交易才会成为这个共享账簿（区块链）的一部分。

比特币系统的信任是建立在计算的基础上的。交易被包在一起放进区块中时需要极大的计算量来证明，但只需少量计算就能验证它们已被证明。挖矿在比特币系统中起着两个作用：

- 挖矿在构建区块时会创造新的比特币，和一个中央银行印发新的纸币很类似。每个区块创造的比特币数量是固定的，随时间会渐渐减少。

- 挖矿创建信任。挖矿确保只有在包含交易的区块上贡献了足够的计算量后，这些交易才被确认。区块越多，花费的计算量越大，意味着更多的信任。

描述挖矿的一个好方法是将之类比为一个巨大的多人数独谜题游戏。一旦有人发现正解之后，这个数独游戏会自动调整困难度以使游戏每次需要大约10分钟解决。想象一个有几千行几千列的巨大数独游戏。如果给你一个已经完成的数独，你可以很快地验证它。然而，如果这个数独只有几个方格里有数字其余方格都为空的话，就会花费非常长的时间来解决。这个数独游戏的困难度可以通过改变其大小（更多或更少行列）来调整，但即使它非常大时验证它也是相当容易的。而比特币中的 "谜题" 是基于哈希加密算法的，其展现了相似的特性：非对称地，它解起来困难而验证很容易，并且它的困难度可以调整。

#### 区块中的交易记录

网络中产生的一笔交易直到成为整个比特币大账簿——区块链的一部分时才会被确认有效。平均每10分钟，矿工会将自上一个区块以来发生的所有交易生成一个新的区块。新交易不断地从用户钱包和应用流入比特币网络。当比特币网络上的节点看到这些交易时，会先将它们放到各自节点维护的一个临时的未经验证的交易池中。当矿工构建一个新区块时，会将这些交易从这个交易池中拿出来放到这个新区块中，然后通过尝试解决一个非常困难的问题（也叫工作量证明）以证明这个新区块的合法性。

这些交易被加进新区块时，以交易费用高的优先以及其它的一些规则进行排序。矿工一旦从网络上收到一个新区块时，会意识到在这个区块上的解题竞赛已经输掉了，会马上开始下一个新区块的挖掘工作。它会立刻将一些交易和这个新区块的数字指纹放在一起开始构建下一个新区块，并开始给它计算工作量证明。每个矿工会在他的区块中包含一个特殊的交易，将新生成的比特币（当前每区块为25比特币）作为报酬支付到他自己的比特币地址。如果他找到了使得新区块有效的解法，他就会得到这笔报酬，因为这个新区块被加入到了总区块链中，他添加的这笔报酬交易也会变成可消费的。

例如一笔交易被网络拿到后放进未验证交易池中。因为包含足够的交易费，它被矿工放到了生成的新区块中。大约在这个交易发送出来五分钟后，矿工的矿机发现了新区块的正解并将之发布为第277,316号区块，包含419个其它交易。矿工的矿机将这个新区块发布到网络上后，其它矿机就会验证它，并投身到构建新区块的竞赛中。

几分钟后，第277,317号新区块诞生在另一个挖矿节点中。因为这个新区块是基于第277,316号区块的，在这个区块的基础上增加了更多的计算，因此就加强了这些交易的可信度。包含之前交易的区块对这个交易来说算一次"证明"。基于这个区块每产生一个新区块，对这个交易来说就会增加了一次"证明"。当区块一个个堆上来时，这个交易变得指数级地越来越难被推翻，因此它在网络中得到更多信任。

![](https://github.com/zeoio/mastering_blockchain/blob/master/blockchain/pictures/2-9.png)

我们可以看到第277,316号区块。在它之下有377,361个区块（包括0号区块），像链子一样一个连着一个（区块链），一直连到0号区块，即创世区块。随着时间变长，这个区块链的高度也随之增长，每个区块和整个链的计算复杂度也随之增加。包含之前交易的区块后面形成的新区块使得信任度进一步增加，因为他们叠加了更多的计算在这个越来越长的链子上。按惯例来说，一个区块获得六次以上“证明”时就被认为是不可撤销的了，因为要撤销和重建六个区块需要巨量的计算。


